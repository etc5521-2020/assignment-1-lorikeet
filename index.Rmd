---
title: "ETC5521 Assignment 1"
subtitle: "Measles Vaccination"
team: Lorikeet
author:
  - Aryan Jain
  - Emily Sheehan
date: "`r Sys.Date()`"
output: 
  html_document
---

[This assignment is for ETC5521 Assignment 1 by Team `r rmarkdown::metadata$team` comprising of `r knitr::combine_words(rmarkdown::metadata$author)`.]{style="color:#006DAE;"}

```{r, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, 
                      message = FALSE, 
                      warning = FALSE)
```

```{r libraries}
library(tidyverse)
library(scales)
library(ggrepel)
library(knitr)
library(kableExtra)
```

# Introduction and motivation

Measles is a highly infectious disease caused by the Measles virus. It can lead to pneumonia, infections of the middle ear, swelling of the brain and death.

A vaccine exists to prevent the onset of measles as there is no treatment. The vaccine involves the injection of attenuated measles antigens that stimulate the production of antibodies and memory cells, providing long-term protection against the virus. When administered properly, the vaccine is 90.5% effective within 72 hours of exposure (Barrabeig et al., 2011).

Unfortunately there is a growing number of individuals refusing vaccination, particularly in the US (Phadke et al., 2016). In Texas, the number of unvaccinated children attaining exemptions to attend school has increased by 28 times since 2003 (Sinclair et al., 2019). This has led to several outbreaks of vaccine preventable diseases, such as Measles. If this trend continues, there could be calamitous consequences. 

This paper hopes to understand the reasons for vaccine refusal and determine whether there is a relationship between socio-economic status and vaccination rate. 

# Data description

The data comprises of vaccination rates for 46,412 schools in 32 U.S states and was retrieved from The Wall Street Journal. The variables include; the school academic year, the school's state, city, county, district, name, type, enrollment, MMR (measles, mumps and rubella) vaccination rate, overall vaccination rate, latitude, longitude and the percentage of students exempted from vaccinations due to personal, religious or medical reasons. 

The data was collected in the 2017-18 school year for 11 states and 2018-19 school year for the remaining 21 states. The state health departments provided the vaccination data and the National Center for Education Statistic's provided the school location, which was matched against the school name. In the case that there was no match, the school's location was found with Google Maps API. 

The individual state dataset was scraped from WSJ github repository and combined with the existing measles dataset with *left_join* to extract the longitude and latitude variables from it. Various functions from the *rvest* package were used to scrape the data including *read_html* and *html_table*.

**Primary Question**: Does Measles vaccination rate improve with better socio-economic conditions?

**Secondary Questions**:

- 1. Which states have the highest and lowest vaccination rates?
- 2. What is the average income in the states with the highest and lowest vaccination rate?
- 3. Is the vaccination rate higher in private schools?
- 4. How does the MMR vaccination rate compare to the school's overall vaccination rate?


# Analysis and findings

[FILL] Should include at least one plot or numerical summary for each of your questions, that helps the reader arrive at an answer. You should also write paragraphs describing the methods, summaries and findings. 

# Emily section

```{r load-data}
measles <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-02-25/measles.csv') 
```

## Is the vaccination rate higher in private schools?

Note: a lot of NAs, the first is not informative because it disregards that there might be more public schools than private therefore i have done the second and used average

Rough method: Removed NAs, grouped by type, then summed all the mmr rates for each type. Divided this number by the total rate to get percentages and represented in a ggplot.

```{r school-type-trial}
school_type <- 
  measles %>%
  # remove NAs
  filter(type != "NA") %>%
  # group by type of school
  group_by(type) %>%
  # count the rate of measles vaccinations in each school
  summarise(percent_added = n()) %>%
  # find the total number of measles
  mutate(total = sum(percent_added))
```


```{r ggplot-school-type-trial}
ggplot(school_type,
       aes(x = "",
           y = percent_added,
           fill = type)) +
  geom_bar(stat = "identity", width = 1) +
  # convert to a pie chart
  coord_polar("y", start = 0) +
  # get rid of axis labels
  theme_void() +
  # add a percentage label to each segment which is colour co-ordinated
  geom_label_repel(label = percent(school_type$percent_added/29491),
                   size= 3,
                   show.legend = F,
                   position = "dodge") +
  ggtitle("Proportion of schools with vaccinations???")
```

```{r school-type-average}
school_type_average <- 
  measles %>%
  # remove missing data
  filter(type != "NA",
         mmr != -1,
         overall != -1) %>%
  # group by type of school
  group_by(type) %>%
  # calculate the average mmr rate and overall rate according to type of school
  summarise(average_mmr_rate = mean(mmr),
            average_vacc_rate = mean(overall)) 
```

```{r ggplot-school-type}
ggplot(school_type_average,
       aes(x = "",
           y = average_mmr_rate,
           group = type)) +
  geom_bar(stat = "identity", width = 1) +
  facet_wrap(~type) +
  # convert to a pie chart
  coord_polar("y", start = 0) +
  # get rid of axis labels
  theme_void() +
  # add a percentage label to each segment which is colour co-ordinated
  geom_label_repel(label = percent(school_type_average$average_mmr_rate/100),
                  size= 3,
                   show.legend = F) +
  ggtitle("The Average MMR Vaccination Rate according to School Type")
```

## How does the MMR vaccination rate compare to the school's overall vaccination rate?

```{r summary-overall-mmr}
school_type_average %>%
  kable(col.names = c("Type",
                      "Average MMR Vaccination Rate",
                      "Average Overall Vaccination Rate"),
        caption = "Comparison of both Average Vaccination Rates according to School Type") %>%
  kable_styling(full_width = TRUE)
```


```{r compare-vacc-rates}
vacc_rates <- school_type_average %>%
   rename(MMR = average_mmr_rate,
         Overall = average_vacc_rate) %>%
  pivot_longer(cols = c("Overall", "MMR"),
               names_to = "vaccine_type",
               values_to = "rate") 
```

```{r vacc-rates-ggplot}
ggplot(vacc_rates,
         aes(x = vaccine_type,
             y = rate,
             group = type)) +
  geom_col() +
  facet_wrap(~type) +
  xlab("Type of Vaccination") + 
  ylab("") +
  theme(axis.ticks = element_blank(),
        panel.background = element_blank(),
        axis.text.y = element_blank()) +
  geom_label_repel(label = percent(vacc_rates$rate/100),
                  size= 3,
                   show.legend = F) +
  ggtitle("Comparison of both Average Vaccination Rates according to School Type")
```




# Aryan section


# References

## Emily's references (I will fix up in APA)
measles definition - https://www.health.gov.au/health-topics/measles#what-is-measles

how vaccine works - https://www.health.qld.gov.au/news-events/news/what-is-measles-why-vaccinate#:~:text=The%20measles%20vaccine%20contains%20a,is%20better%20prepared%20to%20respond.

why people arent vaccinating - Cockcroft, A., Usman, M. U., Nyamucherera, O. F., Emori, H., Duke, B., Umar, N. A., & Andersson, N. (2014). Why children are not vaccinated against measles: a cross-sectional study in two Nigerian States. Archives of Public Health = Archives Belges de Sante Publique, 72(1), 48. 

effectiveness stat - Barrabeig, I., Rovira, A., Rius, C., Muñoz, P., Soldevila, N., Batalla, J., & Domínguez, A. (2011). Effectiveness of measles vaccination for control of exposed children. The Pediatric Infectious Disease Journal, 30(1), 78–80.

growing number of refusal - Phadke, V. K., Bednarczyk, R. A., Salmon, D. A., & Omer, S. B. (2016). Association Between Vaccine Refusal and Vaccine-Preventable Diseases in the United States: A Review of Measles and Pertussis. JAMA: The Journal of the American Medical Association, 315(11), 1149–1158.

28 times - Sinclair, D. R., Grefenstette, J. J., Krauland, M. G., Galloway, D. D., Frankeny, R. J., Travis, C., Burke, D. S., & Roberts, M. S. (2019). Forecasted Size of Measles Outbreaks Associated With Vaccination Exemptions for Schoolchildren. JAMA Network Open, 2(8), e199768.
